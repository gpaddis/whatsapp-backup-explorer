# WhatsApp Backup Explorer
The database schema was generated with `rails db:schema:dump`. Some tables had to be dumped manually, since the command does not automatically recognize some of the fields in WhatsApp's SQLite database.

The models were autogenerated with [schema_to_scaffold](https://github.com/frenesim/schema_to_scaffold).

## Usage
You will need the decrypted msgstore.db file to feed the application and explore the archive.
1. If you have root access to your current Android phone, just extract the file from the WhatsApp data directory.
2. If you don't have root access to your current phone, you can extract the file containing encryption key from any older phone where you had another Whatsapp installation and decrypt the msgstore.db.crypt12 file generated for your Google Drive backup (usually stored in the SD card: /WhatsApp/Databases) with a tool like [WhatsApp-Crypt12-Decrypter](https://github.com/EliteAndroidApps/WhatsApp-Crypt12-Decrypter).
3. If you don't have root access to *any* of your phones, you can still extract the encryption key with an Android emulator using a tool called [WhatsDump](https://github.com/MarcoG3/WhatsDump).

TODO: where to put database / files?

## Whatsapp Entities

### Jid
The `jid` table is the connecting glue between all other objects in the database, so it is important to get it right. With just a couple of fields, the jid is referenced by almost any other object:
- **_id**: the primary key, often referenced by the other objects.
- **user**: often a phone number, sometimes a phone number + id in the case of groups (the phone number is that of the user who created the group)
- **server**: I could find 5 different values for the records: status_me, s.whatsapp.net, broadcast, g.us, temp. Most of the jids are either "s.whatsapp.net" or "g.us", all other server values are service messages.
- **agent**: the value does not seem the be actively used at present.
- **type**: either 0, 1, 2, 3, 5, 11, or 17. For a value mapping, check out [the enum](./app/models/jid.rb).
- **raw_string**: another unique identifier made with phone number + server, sometimes used as foreign key by other objects.
- **device**: either NULL or 0 in the database I examined. The field was probably added with a later migration and it is not yet being used.

Check out https://github.com/sigalor/whatsapp-web-reveng#chat-identification--jid.

### Message
#### Thumbnail
Newer messages rely on the table `message_thumbnails` to store low-resolution pictures in a BLOB field. Older messages used to store the picture in the `raw_data` field of the `messages` table.

## Legal
This code is in no way affiliated with, authorized, maintained, sponsored or endorsed by WhatsApp or any of its affiliates or subsidiaries. This is an independent and unofficial software. Use at your own risk.